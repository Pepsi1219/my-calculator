<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSA Operation Sign-Off Report (v1.5.0)</title>
    <style>
        /* CSS ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å v1.4.0 */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Sarabun', sans-serif; }
        body { background: #f8f9fa; padding: 15px; }
        .report-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,.1); max-width: 1550px; margin: auto; }
        .report-title { text-align: center; margin-bottom: 20px; color: #1a3c6d; border-bottom: 2px solid #1a3c6d; padding-bottom: 10px; }
        .form-header { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px 16px; margin-bottom: 20px; background: #f0f4ff; padding: 15px; border-radius: 8px; }
        .field { display: flex; flex-direction: column; }
        .field label { font-size: .85rem; margin-bottom: 4px; font-weight: 600; color: #444; }
        .field input { padding: 8px 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; }
        .field input[readonly] { background: #e9ecef; }
        
        .stopwatch-bar { background: #fff; border: 2px solid #1a3c6d; padding: 12px; border-radius: 12px; margin-bottom: 20px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 15px; position: sticky; top: 10px; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .timer-display { font-size: 1.8rem; font-weight: bold; font-family: monospace; background: #222; color: #00ff00; padding: 5px 15px; border-radius: 8px; min-width: 140px; text-align: center; }
        
        .table-wrapper { overflow-x: auto; }
        .report-table { width: 100%; border-collapse: collapse; min-width: 1400px; font-size: .85rem; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: center; vertical-align: middle; }
        th { background: #e9ecef; }
        .day-cell { background: #f0f4ff; font-weight: bold; }
        
        /* ‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏î‡πÑ‡∏î‡πâ */
        .clickable-input { cursor: pointer; background: #fffde7 !important; font-weight: bold; color: #1a3c6d; border: 1px solid #ffe082 !important; border-radius: 4px; }
        .clickable-input:hover { background: #fff9c4 !important; }

        .report-table input { width: 100%; border: none; padding: 4px; text-align: center; background: transparent; }
        .report-table input[readonly] { color: #007bff; font-weight: bold; }
        
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: white; margin: 15% auto; padding: 25px; border-radius: 10px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }
        .modal-content h3 { margin-bottom: 15px; color: #1a3c6d; }
        .modal-content input { width: 100%; padding: 12px; font-size: 1.5rem; text-align: center; border: 2px solid #007bff; border-radius: 8px; margin-bottom: 20px; }
        
        .btn { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; display: flex; align-items: center; gap: 5px; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-start { background: #28a745; } .btn-stop { background: #dc3545; } .btn-save { background: #007bff; } .btn-reset { background: #6c757d; }
        .sign-btn-group { display: flex; gap: 10px; justify-content: center; }
        
        .sign-cell { cursor: pointer; min-width: 120px; height: 50px; background: #fff; display: flex; align-items: center; justify-content: center; }
        .sign-cell img { max-height: 45px; display: none; }
        #signature-pad { border: 2px dashed #ccc; background: #fff; margin-bottom: 15px; touch-action: none; }
    </style>
</head>
<body>

<div class="report-container">
    <h1 class="report-title">CSA OPERATION SIGN-OFF REPORT (v1.5.0)</h1>

    <div class="form-header">
        <div class="field"><label>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å</label><input type="text" placeholder=""></div>
        <div class="field"><label>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label><input type="text" placeholder=""></div>
        <div class="field"><label>‡∏Ñ‡∏£‡∏π‡∏ù‡∏∂‡∏Å</label><input type="text" placeholder=""></div>
        <div class="field"><label>SAM (‡∏ô‡∏≤‡∏ó‡∏µ)</label><input type="number" id="globalSam" step="0.001" oninput="calculateAdaptiveGoals()"></div>
        <div class="field"><label style="color: #d63384;">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Eff (%)</label><input type="number" id="globalEffTarget" value="" oninput="calculateAdaptiveGoals()"></div>
        <div class="field"><label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Q'ty (‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.)</label><input type="number" id="globalQtyTarget" readonly></div>
        <div class="field">
    <label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏á‡∏≤‡∏ô</label>
    <select id="workLevel" style="padding: 8px 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; background: white;">
        <option value="" disabled selected></option>
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
        <option value="D">D</option>
    </select>
</div>
        <div class="field"><label style="color: #d63384;">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ù‡∏∂‡∏Å</label><input type="number" id="trainingDays" value="" oninput="calculateAdaptiveGoals()"></div>
        <div class="field">
    <label>‡∏ä‡∏ô‡∏¥‡∏î‡∏ú‡πâ‡∏≤</label>
    <select id="fabricType" style="padding: 8px 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; background: white;">
        <option value="" disabled selected></option>
        <option value="Knitted">‡∏ú‡πâ‡∏≤‡∏ñ‡∏±‡∏Å (Knitted Fabric)</option>
        <option value="Woven">‡∏ú‡πâ‡∏≤‡∏ó‡∏≠ (Woven Fabric)</option>
    </select>
</div>
        <div class="field"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å</label><input type="date"></div>
        <div class="field"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢</label><input type="date"></div>
        
    </div>

    <div class="stopwatch-bar">
        <div class="control-group">
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
            <input type="number" id="targetDay" value="1" min="1" max="30">
        </div>
        <div id="timerDisplay" class="timer-display">00:00:00</div>
        <button class="btn btn-start" id="startStopBtn" onclick="toggleTimer()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤</button>
        <button class="btn btn-reset" onclick="resetTimer()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        <div class="control-group" style="padding-left:15px; border-left:3px solid #007bff;">
            <label>‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ:</label>
            <input type="number" id="cyclesDone" value="1" min="1">
        </div>
        <button class="btn btn-save" onclick="recordAndCalculate()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
    </div>

    <div class="table-wrapper">
        <table class="report-table">
            <thead>
                <tr>
                    <th rowspan="2">‡∏ß‡∏±‡∏ô</th>
                    <th colspan="6">‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (Performance)</th>
                    <th colspan="3">‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (Quality)</th>
                    <th colspan="4">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏•‡∏±‡∏Å</th>
                    <th rowspan="2">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</th>
                    <th rowspan="2">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô</th>
                </tr>
                <tr>
                    <th>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢%</th><th>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô</th>
                    <th>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</th><th>‡∏ô‡∏≤‡∏ó‡∏µ/‡∏£‡∏≠‡∏ö</th>
                    <th>Eff %</th><th>‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.</th>
                    <th>‡∏ú‡πà‡∏≤‡∏ô</th><th>‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</th><th>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡πà‡∏≤‡∏ô %</th>
                    <th>‡∏Ñ‡∏ô</th><th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th><th>‡∏ß‡∏¥‡∏ò‡∏µ</th><th>‡∏ß‡∏±‡∏™‡∏î‡∏∏</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<div id="manualInputModal" class="modal">
    <div class="modal-content">
        <h3>‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</h3>
        <p style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span id="modalDayLabel"></span></p>
        <input type="number" id="manualSecondsInput" step="0.01" placeholder="‡πÄ‡∏ä‡πà‡∏ô 70.5">
        <div class="sign-btn-group">
            <button class="btn btn-save" onclick="saveManualSeconds()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button class="btn btn-stop" onclick="closeManualModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>
</div>

<div id="signModal" class="modal">
    <div class="modal-content">
        <h3>‡∏•‡∏á‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</h3>
        <canvas id="signature-pad" width="450" height="200"></canvas>
        <div class="sign-btn-group">
            <button class="btn btn-reset" onclick="clearPad()">‡∏•‡πâ‡∏≤‡∏á</button>
            <button class="btn btn-save" onclick="saveSignature()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button class="btn btn-stop" onclick="closeSignPad()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>
</div>

<script>
let startTime, timerInterval, elapsedTime = 0, isRunning = false;
let currentActiveDay = null; // ‡πÄ‡∏Å‡πá‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)

// 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á 30 ‡∏ß‡∏±‡∏ô
const tbody = document.getElementById("tableBody");
for(let d=1; d<=30; d++) {
    const row = document.createElement("tr");
    row.innerHTML = `
        <td class="day-cell">${d}</td>
        <td><input type="text" id="targetEff_${d}" readonly></td>
        <td><input type="text" id="targetQty_${d}" readonly></td>
        <td><input type="text" id="resAvgSec_${d}" readonly class="clickable-input" onclick="openManualModal(${d})" placeholder="‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà"></td>
        <td><input type="text" id="resAvgMin_${d}" readonly></td>
        <td><input type="text" id="resEffPerc_${d}" readonly style="background:#fff3cd;"></td>
        <td><input type="text" id="resEffPcs_${d}" readonly></td>
        <td><input type="number" id="qPass_${d}" oninput="manualCalculate(${d})"></td>
        <td><input type="number" id="qFail_${d}" oninput="manualCalculate(${d})"></td>
        <td><input type="text" id="resQRates_${d}" readonly></td>
        <td><input type="checkbox"></td><td><input type="checkbox"></td>
        <td><input type="checkbox"></td><td><input type="checkbox"></td>
        <td><input type="text" style="text-align:left;"></td>
        <td class="sign-cell" onclick="openSignPad(${d})">
            <span class="placeholder-text" id="signText_${d}">‡πÄ‡∏ã‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠</span>
            <img id="signImg_${d}" src="">
        </td>
    `;
    tbody.appendChild(row);
}

// --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: Manual Seconds Modal ---
function openManualModal(day) {
    currentActiveDay = day;
    document.getElementById('modalDayLabel').innerText = day;
    const currentVal = document.getElementById(`resAvgSec_${day}`).value;
    document.getElementById('manualSecondsInput').value = currentVal || "";
    document.getElementById('manualInputModal').style.display = 'block';
    setTimeout(() => document.getElementById('manualSecondsInput').focus(), 100);
}

function closeManualModal() {
    document.getElementById('manualInputModal').style.display = 'none';
}

function saveManualSeconds() {
    const sec = parseFloat(document.getElementById('manualSecondsInput').value);
    if (!isNaN(sec) && sec >= 0) {
        document.getElementById(`resAvgSec_${currentActiveDay}`).value = sec.toFixed(2);
        manualCalculate(currentActiveDay); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ñ‡∏ß
        calculateAdaptiveGoals(); // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà (Adaptive)
        closeManualModal();
    } else {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
    }
}

// 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Adaptive Logic) ‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°
function calculateAdaptiveGoals() {
    const globalEff = parseFloat(document.getElementById('globalEffTarget').value) || 0;
    const trainDays = parseInt(document.getElementById('trainingDays').value) || 1;
    const sam = parseFloat(document.getElementById('globalSam').value) || 0;

    const qtyT = (sam > 0) ? Math.ceil((60 / sam) * (globalEff / 100)) : 0;
    document.getElementById('globalQtyTarget').value = qtyT;

    let lastActualEff = 0, lastActualDay = 0;
    for (let d = 1; d <= 30; d++) {
        let actualEffStr = document.getElementById(`resEffPerc_${d}`).value;
        if (actualEffStr) { lastActualEff = parseFloat(actualEffStr); lastActualDay = d; }
    }

    for (let d = 1; d <= 30; d++) {
        let targetValue = 0;
        if (d <= lastActualDay || lastActualDay === 0) {
            targetValue = (globalEff / trainDays) * d;
        } else {
            const remainingDays = trainDays - lastActualDay;
            if (remainingDays > 0 && d <= trainDays) {
                const increment = (globalEff - lastActualEff) / remainingDays;
                targetValue = lastActualEff + (increment * (d - lastActualDay));
            } else { targetValue = globalEff; }
        }
        const finalTarget = Math.ceil(Math.min(targetValue, globalEff));
        const targetInput = document.getElementById(`targetEff_${d}`);
        if (d <= trainDays || d <= lastActualDay) {
            targetInput.value = finalTarget + "%";
            if (sam > 0) document.getElementById(`targetQty_${d}`).value = Math.ceil((60 / sam) * (finalTarget / 100));
        } else {
            targetInput.value = ""; document.getElementById(`targetQty_${d}`).value = "";
        }
    }
}

// 3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ & ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (‡πÅ‡∏ö‡∏ö‡∏î‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏¥‡∏°)
function toggleTimer() {
    const btn = document.getElementById('startStopBtn');
    if (!isRunning) {
        isRunning = true; btn.innerText = "‡∏´‡∏¢‡∏∏‡∏î"; btn.className = "btn btn-stop";
        startTime = Date.now() - elapsedTime;
        timerInterval = setInterval(() => {
            elapsedTime = Date.now() - startTime;
            updateTimerDisplay();
        }, 10);
    } else {
        isRunning = false; btn.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠"; btn.className = "btn btn-start";
        clearInterval(timerInterval);
    }
}

function updateTimerDisplay() {
    const totalSec = Math.floor(elapsedTime / 1000);
    const m = Math.floor(totalSec / 60).toString().padStart(2, '0');
    const s = (totalSec % 60).toString().padStart(2, '0');
    const ms = Math.floor((elapsedTime % 1000) / 10).toString().padStart(2, '0');
    document.getElementById('timerDisplay').innerText = `${m}:${s}:${ms}`;
}

function resetTimer() {
    clearInterval(timerInterval);
    elapsedTime = 0; isRunning = false;
    document.getElementById('timerDisplay').innerText = "00:00:00";
    document.getElementById('startStopBtn').innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤";
    document.getElementById('startStopBtn').className = "btn btn-start";
}

function recordAndCalculate() {
    const day = document.getElementById('targetDay').value;
    const cycles = parseFloat(document.getElementById('cyclesDone').value) || 1;
    if (elapsedTime === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô");
    const avgSec = (elapsedTime / 1000) / cycles;
    document.getElementById(`resAvgSec_${day}`).value = avgSec.toFixed(2);
    manualCalculate(day);
    calculateAdaptiveGoals();
}

function manualCalculate(d) {
    const sam = parseFloat(document.getElementById('globalSam').value) || 0;
    const avgSec = parseFloat(document.getElementById(`resAvgSec_${d}`).value) || 0;
    const pass = parseFloat(document.getElementById(`qPass_${d}`).value) || 0;
    const fail = parseFloat(document.getElementById(`qFail_${d}`).value) || 0;

    if (avgSec > 0) {
        const avgMin = avgSec / 60;
        document.getElementById(`resAvgMin_${d}`).value = avgMin.toFixed(2);
        if (sam > 0) {
            const eff = Math.ceil((sam / avgMin) * 100);
            document.getElementById(`resEffPerc_${d}`).value = eff + "%";
            document.getElementById(`resEffPcs_${d}`).value = Math.ceil(60 / avgMin);
        }
    }
    const totalQ = pass + fail;
    if (totalQ > 0) document.getElementById(`resQRates_${d}`).value = Math.ceil((pass/totalQ)*100) + "%";
}

// 4. ‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô
const canvas = document.getElementById('signature-pad');
const ctx = canvas.getContext('2d');
let writing = false;
function openSignPad(day) { currentActiveDay = day; document.getElementById('signModal').style.display = 'block'; clearPad(); }
function closeSignPad() { document.getElementById('signModal').style.display = 'none'; }
function clearPad() { ctx.clearRect(0, 0, canvas.width, canvas.height); ctx.lineWidth = 2; ctx.strokeStyle = '#1a3c6d'; }
function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return { x: clientX - rect.left, y: clientY - rect.top };
}
canvas.addEventListener('mousedown', (e) => { writing = true; ctx.beginPath(); const pos = getPos(e); ctx.moveTo(pos.x, pos.y); });
canvas.addEventListener('mousemove', (e) => { if(!writing) return; const pos = getPos(e); ctx.lineTo(pos.x, pos.y); ctx.stroke(); });
window.addEventListener('mouseup', () => writing = false);
canvas.addEventListener('touchstart', (e) => { writing = true; ctx.beginPath(); const pos = getPos(e); ctx.moveTo(pos.x, pos.y); e.preventDefault(); }, {passive: false});
canvas.addEventListener('touchmove', (e) => { if(!writing) return; const pos = getPos(e); ctx.lineTo(pos.x, pos.y); ctx.stroke(); e.preventDefault(); }, {passive: false});
function saveSignature() {
    const dataURL = canvas.toDataURL();
    document.getElementById(`signImg_${currentActiveDay}`).src = dataURL;
    document.getElementById(`signImg_${currentActiveDay}`).style.display = 'block';
    document.getElementById(`signText_${currentActiveDay}`).style.display = 'none';
    closeSignPad();
}

calculateAdaptiveGoals();
</script>

</body>
</html>
