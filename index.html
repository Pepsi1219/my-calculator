<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSA Operation Sign-Off Report (v1.2.0)</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Sarabun', 'Segoe UI', Tahoma, sans-serif; }
        body { background: #f8f9fa; padding: 15px; }
        .report-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,.1); max-width: 1400px; margin: auto; }
        .report-title { text-align: center; margin-bottom: 20px; color: #1a3c6d; border-bottom: 2px solid #1a3c6d; padding-bottom: 10px; }
        
        /* Header Section */
        .form-header { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px 16px; margin-bottom: 20px; background: #f0f4ff; padding: 15px; border-radius: 8px; }
        .field { display: flex; flex-direction: column; }
        .field label { font-size: .85rem; margin-bottom: 4px; font-weight: 600; color: #444; }
        .field input { padding: 8px 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1rem; }
        .field input[readonly] { background: #e9ecef; color: #495057; }

        /* Modern Stopwatch Bar */
        .stopwatch-bar { background: #fff; border: 2px solid #1a3c6d; padding: 12px; border-radius: 12px; margin-bottom: 20px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 15px; position: sticky; top: 10px; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .timer-display { font-size: 1.8rem; font-weight: bold; font-family: monospace; background: #222; color: #00ff00; padding: 5px 15px; border-radius: 8px; border: 2px solid #444; min-width: 140px; text-align: center; }
        
        .control-group { display: flex; align-items: center; gap: 8px; background: #f8f9fa; padding: 5px 12px; border-radius: 8px; border: 1px solid #ddd; }
        .control-group label { font-weight: bold; font-size: 0.9rem; color: #1a3c6d; }
        .control-group input { width: 60px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; text-align: center; font-weight: bold; }

        /* Table Style */
        .table-wrapper { overflow-x: auto; }
        .report-table { width: 100%; border-collapse: collapse; min-width: 1100px; font-size: .85rem; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: center; vertical-align: middle; }
        th { background: #e9ecef; position: sticky; top: 0; z-index: 10; }
        .highlight-header { background: #ffebee; }
        .day-cell { background: #f0f4ff; font-weight: bold; width: 45px; }
        
        /* Table Inputs */
        .report-table input { width: 100%; border: none; padding: 4px; text-align: center; background: transparent; font-size: 0.9rem; }
        .report-table input:focus { background: #fff9c4; outline: 1px solid #1a3c6d; border-radius: 3px; }
        .report-table input[readonly] { color: #007bff; font-weight: bold; }
        
        .btn { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; display: flex; align-items: center; gap: 5px; }
        .btn-start { background: #28a745; }
        .btn-stop { background: #dc3545; }
        .btn-save { background: #007bff; }
        .btn-reset { background: #6c757d; }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

<div class="report-container">
    <h1 class="report-title">CSA OPERATION SIGN-OFF REPORT</h1>

    <div class="form-header">
        <div class="field"><label>‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏Å</label><input type="text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô..."></div>
        <div class="field"><label>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label><input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div>
        <div class="field"><label>‡∏Ñ‡∏£‡∏π‡∏ù‡∏∂‡∏Å</label><input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div>
        <div class="field"><label>SAM (‡∏ô‡∏≤‡∏ó‡∏µ)</label><input type="number" id="globalSam" step="0.000" oninput="calculateAllRows()"></div>
        <div class="field"><label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Eff (%)</label><input type="number" id="globalEffTarget" value="100" oninput="calculateAllRows()"></div>
        <div class="field"><label>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ Q'ty (‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.)</label><input type="number" id="globalQtyTarget" readonly></div>
        <div class="field"><label>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏á‡∏≤‡∏ô</label><input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div>
        <div class="field"><label>‡∏ä‡∏ô‡∏¥‡∏î‡∏ú‡πâ‡∏≤</label><input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"></div>
        <div class="field"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å</label><input type="date"></div>
    </div>
        <div class="field"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢</label><input type="date"></div>
    </div>

    <div class="stopwatch-bar">
        <div class="control-group">
            <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
            <input type="number" id="targetDay" value="1" min="1" max="30">
        </div>

        <div id="timerDisplay" class="timer-display">00:00:00</div>

        <button class="btn btn-start" id="startStopBtn" onclick="toggleTimer()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤</button>
        <button class="btn btn-reset" onclick="resetTimer()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>

        <div class="control-group" style="border-left: 3px solid #007bff;">
            <label>‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ:</label>
            <input type="number" id="cyclesDone" value="1" min="1">
        </div>

        <button class="btn btn-save" onclick="recordAndCalculate()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
    </div>

    <div class="table-wrapper">
        <table class="report-table">
            <thead>
                <tr>
                    <th rowspan="2">‡∏ß‡∏±‡∏ô</th>
                    <th colspan="4" class="highlight-header">‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û (Performance)</th>
                    <th colspan="3" class="highlight-header">‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (Quality)</th>
                    <th colspan="4" class="highlight-header">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏•‡∏±‡∏Å (Root Cause)</th>
                    <th rowspan="2">‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                </tr>
                <tr>
                    <th style="width:110px">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</th>
                    <th style="width:110px">‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡πà‡∏≠‡∏£‡∏≠‡∏ö (‡∏ô‡∏≤‡∏ó‡∏µ)</th>
                    <th style="width:100px">Eff %</th>
                    <th style="width:110px">Eff ‡∏ä‡∏¥‡πâ‡∏ô/‡∏ä‡∏°.</th>
                    
                    <th style="width:80px">‡∏ú‡πà‡∏≤‡∏ô</th>
                    <th style="width:80px">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</th>
                    <th style="width:100px">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ú‡πà‡∏≤‡∏ô %</th>
                    
                    <th style="width:50px">‡∏Ñ‡∏ô</th>
                    <th style="width:50px">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</th>
                    <th style="width:50px">‡∏ß‡∏¥‡∏ò‡∏µ</th>
                    <th style="width:50px">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>
</div>

<script>
let startTime, timerInterval, elapsedTime = 0, isRunning = false;

// ‡πÄ‡∏à‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á 30 ‡∏ß‡∏±‡∏ô (‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏ß‡∏°‡∏≠‡∏≠‡∏Å)
const tbody = document.getElementById("tableBody");
for(let d=1; d<=30; d++) {
    const row = document.createElement("tr");
    row.innerHTML = `
        <td class="day-cell">${d}</td>
        <td><input type="number" id="resAvgSec_${d}" oninput="manualCalculate(${d})" placeholder="..."></td>
        <td><input type="text" id="resAvgMin_${d}" readonly></td>
        <td><input type="text" id="resEffPerc_${d}" readonly></td>
        <td><input type="text" id="resEffPcs_${d}" readonly></td>
        <td><input type="number" id="qPass_${d}" oninput="manualCalculate(${d})"></td>
        <td><input type="number" id="qFail_${d}" oninput="manualCalculate(${d})"></td>
        <td><input type="text" id="resQRates_${d}" readonly></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="checkbox"></td>
        <td><input type="text" style="text-align:left; padding-left:10px"></td>
    `;
    tbody.appendChild(row);
}

// ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
function toggleTimer() {
    const btn = document.getElementById('startStopBtn');
    if (!isRunning) {
        isRunning = true;
        btn.innerText = "‡∏´‡∏¢‡∏∏‡∏î"; btn.className = "btn btn-stop";
        startTime = Date.now() - elapsedTime;
        timerInterval = setInterval(updateTimerDisplay, 10);
    } else {
        isRunning = false;
        btn.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πà‡∏≠"; btn.className = "btn btn-start";
        clearInterval(timerInterval);
    }
}

function updateTimerDisplay() {
    elapsedTime = Date.now() - startTime;
    const totalSec = Math.floor(elapsedTime / 1000);
    const m = Math.floor(totalSec / 60).toString().padStart(2, '0');
    const s = (totalSec % 60).toString().padStart(2, '0');
    const ms = Math.floor((elapsedTime % 1000) / 10).toString().padStart(2, '0');
    document.getElementById('timerDisplay').innerText = `${m}:${s}:${ms}`;
}

function resetTimer() {
    clearInterval(timerInterval);
    elapsedTime = 0; isRunning = false;
    document.getElementById('timerDisplay').innerText = "00:00:00";
    document.getElementById('startStopBtn').innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤";
    document.getElementById('startStopBtn').className = "btn btn-start";
}

// --- ‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (Core Logic) ---
function recordAndCalculate() {
    const day = document.getElementById('targetDay').value;
    const cycles = parseFloat(document.getElementById('cyclesDone').value) || 1;
    
    // 1. ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏£‡∏ß‡∏°
    const totalSecondsCaptured = elapsedTime / 1000;
    
    // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏£‡∏ß‡∏° / ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö)
    const avgSecPerCycle = totalSecondsCaptured / cycles;
    
    // 3. ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)"
    const targetInput = document.getElementById(`resAvgSec_${day}`);
    targetInput.value = avgSecPerCycle.toFixed(2);
    
    // 4. ‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ô‡∏±‡πâ‡∏ô
    manualCalculate(day);
    
    // ‡∏™‡∏±‡πà‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)
    if(navigator.vibrate) navigator.vibrate(50);
}

function manualCalculate(d) {
    const sam = parseFloat(document.getElementById('globalSam').value) || 0;
    const avgSec = parseFloat(document.getElementById(`resAvgSec_${d}`).value) || 0;
    const pass = parseFloat(document.getElementById(`qPass_${d}`).value) || 0;
    const fail = parseFloat(document.getElementById(`qFail_${d}`).value) || 0;

    if (avgSec > 0) {
        const avgMin = avgSec / 60;
        document.getElementById(`resAvgMin_${d}`).value = avgMin.toFixed(2);

        if (sam > 0) {
            // ‡∏™‡∏π‡∏ï‡∏£: (SAM / Actual Min) * 100
            const eff = Math.ceil((sam / avgMin) * 100);
            document.getElementById(`resEffPerc_${d}`).value = eff + "%";
            // ‡∏™‡∏π‡∏ï‡∏£: 60 / Actual Min
            document.getElementById(`resEffPcs_${d}`).value = Math.ceil(60 / avgMin);
        }
    }

    // ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
    const totalQ = pass + fail;
    if (totalQ > 0) {
        const qRate = Math.ceil((pass / totalQ) * 100);
        document.getElementById(`resQRates_${d}`).value = qRate + "%";
    }
}

function calculateAllRows() {
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô Header
    const sam = parseFloat(document.getElementById('globalSam').value) || 0;
    const effT = parseFloat(document.getElementById('globalEffTarget').value) || 0;
    if (sam > 0 && effT > 0) {
        document.getElementById('globalQtyTarget').value = Math.ceil((60 / sam) * (effT / 100));
    }
    // ‡∏£‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß
    for(let d=1; d<=30; d++) manualCalculate(d);
}
</script>

</body>
</html>
